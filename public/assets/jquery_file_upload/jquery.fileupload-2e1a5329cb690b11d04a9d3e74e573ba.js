/*
 * jQuery File Upload Plugin 5.8
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./vendor/jquery.ui.widget","./jquery.iframe-transport"],e):e(window.jQuery)}(function(e){"use strict";e.widget("blueimp.fileupload",{options:{namespace:void 0,dropZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,formData:function(e){return e.serializeArray()},add:function(e,t){t.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","dropZone","fileInput"],_isXHRUpload:function(e){var t="undefined";return!(e.forceIframeTransport||typeof XMLHttpRequestUpload===t||typeof File===t||e.multipart&&typeof FormData===t)},_getFormData:function(t){var i;return"function"==typeof t.formData?t.formData(t.form):e.isArray(t.formData)?t.formData:t.formData?(i=[],e.each(t.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_onProgress:function(e,t){if(e.lengthComputable){var i=t.total||this._getTotal(t.files),n=parseInt(e.loaded/e.total*(t.chunkSize||i),10)+(t.uploadedBytes||0);this._loaded+=n-(t.loaded||t.uploadedBytes||0),t.lengthComputable=!0,t.loaded=n,t.total=i,this._trigger("progress",e,t),this._trigger("progressall",e,{lengthComputable:!0,loaded:this._loaded,total:this._total})}},_initProgressListener:function(t){var i=this,n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&(e(n.upload).bind("progress",function(e){var n=e.originalEvent;e.lengthComputable=n.lengthComputable,e.loaded=n.loaded,e.total=n.total,i._onProgress(e,t)}),t.xhr=function(){return n})},_initXHRData:function(t){var i,n=t.files[0];(!t.multipart||t.blob)&&(t.headers=e.extend(t.headers,{"X-File-Name":n.name,"X-File-Type":n.type,"X-File-Size":n.size}),t.blob?t.multipart||(t.contentType="application/octet-stream",t.data=t.blob):(t.contentType=n.type,t.data=n)),t.multipart&&"undefined"!=typeof FormData&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:t.paramName,value:t.blob}):e.each(t.files,function(e,n){i.push({name:t.paramName,value:n})})):(t.formData instanceof FormData?i=t.formData:(i=new FormData,e.each(this._getFormData(t),function(e,t){i.append(t.name,t.value)})),t.blob?i.append(t.paramName,t.blob,n.name):e.each(t.files,function(e,n){n instanceof Blob&&i.append(t.paramName,n,n.name)})),t.data=i),t.blob=null},_initIframeSettings:function(t){t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&e("<a></a>").prop("href",t.url).prop("host")!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e,"iframe")},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form"))),t.paramName||(t.paramName=t.fileInput.prop("name")||"files[]"),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&(t.type="POST")},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,n){var s=e.Deferred(),a=s.promise();return i=i||this.options.context||a,t===!0?s.resolveWith(i,n):t===!1&&s.rejectWith(i,n),a.abort=s.promise,this._enhancePromise(a)},_chunkedUpload:function(t,i){var n,s,a,o,r=this,l=t.files[0],c=l.size,u=t.uploadedBytes=t.uploadedBytes||0,d=t.maxChunkSize||c,h=l.webkitSlice||l.mozSlice||l.slice;return this._isXHRUpload(t)&&h&&(u||c>d)&&!t.data?i?!0:u>=c?(l.error="uploadedBytes",this._getXHRPromise(!1,t.context,[null,"error",l.error])):(s=Math.ceil((c-u)/d),n=function(i){return i?n(i-=1).pipe(function(){var n=e.extend({},t);return n.blob=h.call(l,u+i*d,u+(i+1)*d),n.chunkSize=n.blob.size,r._initXHRData(n),r._initProgressListener(n),a=(e.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(){n.loaded||r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:n.chunkSize,total:n.chunkSize}),n),t.uploadedBytes=n.uploadedBytes+=n.chunkSize})}):r._getXHRPromise(!0,t.context)},o=n(s),o.abort=function(){return a.abort()},this._enhancePromise(o)):!1},_beforeSend:function(e,t){0===this._active&&this._trigger("start"),this._active+=1,this._loaded+=t.uploadedBytes||0,this._total+=this._getTotal(t.files)},_onDone:function(t,i,n,s){this._isXHRUpload(s)||this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:1,total:1}),s),s.result=t,s.textStatus=i,s.jqXHR=n,this._trigger("done",null,s)},_onFail:function(e,t,i,n){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,this._trigger("fail",null,n),n.recalculateProgress&&(this._loaded-=n.loaded||n.uploadedBytes||0,this._total-=n.total||this._getTotal(n.files))},_onAlways:function(e,t,i,n){this._active-=1,n.textStatus=t,i&&i.always?(n.jqXHR=i,n.result=e):(n.jqXHR=e,n.errorThrown=i),this._trigger("always",null,n),0===this._active&&(this._trigger("stop"),this._loaded=this._total=0)},_onSend:function(t,i){var n,s,a,o=this,r=o._getAJAXSettings(i),l=function(i,s){return o._sending+=1,n=n||(i!==!1&&o._trigger("send",t,r)!==!1&&(o._chunkedUpload(r)||e.ajax(r))||o._getXHRPromise(!1,r.context,s)).done(function(e,t,i){o._onDone(e,t,i,r)}).fail(function(e,t,i){o._onFail(e,t,i,r)}).always(function(e,t,i){if(o._sending-=1,o._onAlways(e,t,i,r),r.limitConcurrentUploads&&r.limitConcurrentUploads>o._sending)for(var n=o._slots.shift();n;){if(!n.isRejected()){n.resolve();break}n=o._slots.shift()}})};return this._beforeSend(t,r),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(s=e.Deferred(),this._slots.push(s),a=s.pipe(l)):a=this._sequence=this._sequence.pipe(l,l),a.abort=function(){var e=[void 0,"abort","abort"];return n?n.abort():(s&&s.rejectWith(e),l(!1,e))},this._enhancePromise(a)):l()},_onAdd:function(t,i){var n,s,a=this,o=!0,r=e.extend({},this.options,i),l=r.limitMultiFileUploads;if((r.singleFileUploads||l)&&this._isXHRUpload(r)){if(!r.singleFileUploads&&l)for(n=[],s=0;s<i.files.length;s+=l)n.push(i.files.slice(s,s+l))}else n=[i.files];return i.originalFiles=i.files,e.each(n||i.files,function(s,r){var l=n?r:[r],c=e.extend({},i,{files:l});return c.submit=function(){return c.jqXHR=this.jqXHR=a._trigger("submit",t,this)!==!1&&a._onSend(t,this),this.jqXHR},o=a._trigger("add",t,c)}),o},_normalizeFile:function(e,t){void 0===t.name&&void 0===t.size&&(t.name=t.fileName,t.size=t.fileSize)},_replaceFileInput:function(t){var i=t.clone(!0);e("<form></form>").append(i)[0].reset(),t.after(i).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,n){return n===t[0]?i[0]:n}),t[0]===this.element[0]&&(this.element=i)},_onChange:function(t){var i=t.data.fileupload,n={files:e.each(e.makeArray(t.target.files),i._normalizeFile),fileInput:e(t.target),form:e(t.target.form)};return n.files.length||(n.files=[{name:t.target.value.replace(/^.*\\/,"")}]),i.options.replaceFileInput&&i._replaceFileInput(n.fileInput),i._trigger("change",t,n)===!1||i._onAdd(t,n)===!1?!1:void 0},_onPaste:function(t){var i=t.data.fileupload,n=t.originalEvent.clipboardData,s=n&&n.items||[],a={files:[]};return e.each(s,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&a.files.push(i)}),i._trigger("paste",t,a)===!1||i._onAdd(t,a)===!1?!1:void 0},_onDrop:function(t){var i=t.data.fileupload,n=t.dataTransfer=t.originalEvent.dataTransfer,s={files:e.each(e.makeArray(n&&n.files),i._normalizeFile)};return i._trigger("drop",t,s)===!1||i._onAdd(t,s)===!1?!1:(t.preventDefault(),void 0)},_onDragOver:function(e){var t=e.data.fileupload,i=e.dataTransfer=e.originalEvent.dataTransfer;return t._trigger("dragover",e)===!1?!1:(i&&(i.dropEffect=i.effectAllowed="copy"),e.preventDefault(),void 0)},_initEventHandlers:function(){var e=this.options.namespace;this.options.dropZone.bind("dragover."+e,{fileupload:this},this._onDragOver).bind("drop."+e,{fileupload:this},this._onDrop).bind("paste."+e,{fileupload:this},this._onPaste),this.options.fileInput.bind("change."+e,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var e=this.options.namespace;this.options.dropZone.unbind("dragover."+e,this._onDragOver).unbind("drop."+e,this._onDrop).unbind("paste."+e,this._onPaste),this.options.fileInput.unbind("change."+e,this._onChange)},_setOption:function(t,i){var n=-1!==e.inArray(t,this._refreshOptionsList);n&&this._destroyEventHandlers(),e.Widget.prototype._setOption.call(this,t,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is("input:file")?this.element:this.element.find("input:file"):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone))},_create:function(){var t=this.options,i=e.extend({},this.element.data());i[this.widgetName]=void 0,e.extend(t,i),t.namespace=t.namespace||this.widgetName,this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),e.Widget.prototype.destroy.call(this)},enable:function(){e.Widget.prototype.enable.call(this),this._initEventHandlers()},disable:function(){this._destroyEventHandlers(),e.Widget.prototype.disable.call(this)},add:function(t){t&&!this.options.disabled&&(t.files=e.each(e.makeArray(t.files),this._normalizeFile),this._onAdd(null,t))},send:function(t){return t&&!this.options.disabled&&(t.files=e.each(e.makeArray(t.files),this._normalizeFile),t.files.length)?this._onSend(null,t):this._getXHRPromise(!1,t&&t.context)}})});