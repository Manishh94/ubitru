/*
 * jQuery File Upload Plugin 5.8
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","./vendor/jquery.ui.widget","./jquery.iframe-transport"],t):t(window.jQuery)}(function(t){"use strict";t.widget("blueimp.fileupload",{options:{namespace:void 0,dropZone:t(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,formData:function(t){return t.serializeArray()},add:function(t,e){e.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","dropZone","fileInput"],_isXHRUpload:function(t){var e="undefined";return!(t.forceIframeTransport||typeof XMLHttpRequestUpload===e||typeof File===e||t.multipart&&typeof FormData===e)},_getFormData:function(e){var i;return"function"==typeof e.formData?e.formData(e.form):t.isArray(e.formData)?e.formData:e.formData?(i=[],t.each(e.formData,function(t,e){i.push({name:t,value:e})}),i):[]},_getTotal:function(e){var i=0;return t.each(e,function(t,e){i+=e.size||1}),i},_onProgress:function(t,e){if(t.lengthComputable){var i=e.total||this._getTotal(e.files),n=parseInt(t.loaded/t.total*(e.chunkSize||i),10)+(e.uploadedBytes||0);this._loaded+=n-(e.loaded||e.uploadedBytes||0),e.lengthComputable=!0,e.loaded=n,e.total=i,this._trigger("progress",t,e),this._trigger("progressall",t,{lengthComputable:!0,loaded:this._loaded,total:this._total})}},_initProgressListener:function(e){var i=this,n=e.xhr?e.xhr():t.ajaxSettings.xhr();n.upload&&(t(n.upload).bind("progress",function(t){var n=t.originalEvent;t.lengthComputable=n.lengthComputable,t.loaded=n.loaded,t.total=n.total,i._onProgress(t,e)}),e.xhr=function(){return n})},_initXHRData:function(e){var i,n=e.files[0];(!e.multipart||e.blob)&&(e.headers=t.extend(e.headers,{"X-File-Name":n.name,"X-File-Type":n.type,"X-File-Size":n.size}),e.blob?e.multipart||(e.contentType="application/octet-stream",e.data=e.blob):(e.contentType=n.type,e.data=n)),e.multipart&&"undefined"!=typeof FormData&&(e.postMessage?(i=this._getFormData(e),e.blob?i.push({name:e.paramName,value:e.blob}):t.each(e.files,function(t,n){i.push({name:e.paramName,value:n})})):(e.formData instanceof FormData?i=e.formData:(i=new FormData,t.each(this._getFormData(e),function(t,e){i.append(e.name,e.value)})),e.blob?i.append(e.paramName,e.blob,n.name):t.each(e.files,function(t,n){n instanceof Blob&&i.append(e.paramName,n,n.name)})),e.data=i),e.blob=null},_initIframeSettings:function(e){e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&t("<a></a>").prop("href",e.url).prop("host")!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(t){this._isXHRUpload(t)?(this._chunkedUpload(t,!0)||(t.data||this._initXHRData(t),this._initProgressListener(t)),t.postMessage&&(t.dataType="postmessage "+(t.dataType||""))):this._initIframeSettings(t,"iframe")},_initFormSettings:function(e){e.form&&e.form.length||(e.form=t(e.fileInput.prop("form"))),e.paramName||(e.paramName=e.fileInput.prop("name")||"files[]"),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&(e.type="POST")},_getAJAXSettings:function(e){var i=t.extend({},this.options,e);return this._initFormSettings(i),this._initDataSettings(i),i},_enhancePromise:function(t){return t.success=t.done,t.error=t.fail,t.complete=t.always,t},_getXHRPromise:function(e,i,n){var s=t.Deferred(),o=s.promise();return i=i||this.options.context||o,e===!0?s.resolveWith(i,n):e===!1&&s.rejectWith(i,n),o.abort=s.promise,this._enhancePromise(o)},_chunkedUpload:function(e,i){var n,s,o,a,r=this,l=e.files[0],c=l.size,h=e.uploadedBytes=e.uploadedBytes||0,u=e.maxChunkSize||c,d=l.webkitSlice||l.mozSlice||l.slice;return this._isXHRUpload(e)&&d&&(h||c>u)&&!e.data?i?!0:h>=c?(l.error="uploadedBytes",this._getXHRPromise(!1,e.context,[null,"error",l.error])):(s=Math.ceil((c-h)/u),n=function(i){return i?n(i-=1).pipe(function(){var n=t.extend({},e);return n.blob=d.call(l,h+i*u,h+(i+1)*u),n.chunkSize=n.blob.size,r._initXHRData(n),r._initProgressListener(n),o=(t.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(){n.loaded||r._onProgress(t.Event("progress",{lengthComputable:!0,loaded:n.chunkSize,total:n.chunkSize}),n),e.uploadedBytes=n.uploadedBytes+=n.chunkSize})}):r._getXHRPromise(!0,e.context)},a=n(s),a.abort=function(){return o.abort()},this._enhancePromise(a)):!1},_beforeSend:function(t,e){0===this._active&&this._trigger("start"),this._active+=1,this._loaded+=e.uploadedBytes||0,this._total+=this._getTotal(e.files)},_onDone:function(e,i,n,s){this._isXHRUpload(s)||this._onProgress(t.Event("progress",{lengthComputable:!0,loaded:1,total:1}),s),s.result=e,s.textStatus=i,s.jqXHR=n,this._trigger("done",null,s)},_onFail:function(t,e,i,n){n.jqXHR=t,n.textStatus=e,n.errorThrown=i,this._trigger("fail",null,n),n.recalculateProgress&&(this._loaded-=n.loaded||n.uploadedBytes||0,this._total-=n.total||this._getTotal(n.files))},_onAlways:function(t,e,i,n){this._active-=1,n.textStatus=e,i&&i.always?(n.jqXHR=i,n.result=t):(n.jqXHR=t,n.errorThrown=i),this._trigger("always",null,n),0===this._active&&(this._trigger("stop"),this._loaded=this._total=0)},_onSend:function(e,i){var n,s,o,a=this,r=a._getAJAXSettings(i),l=function(i,s){return a._sending+=1,n=n||(i!==!1&&a._trigger("send",e,r)!==!1&&(a._chunkedUpload(r)||t.ajax(r))||a._getXHRPromise(!1,r.context,s)).done(function(t,e,i){a._onDone(t,e,i,r)}).fail(function(t,e,i){a._onFail(t,e,i,r)}).always(function(t,e,i){if(a._sending-=1,a._onAlways(t,e,i,r),r.limitConcurrentUploads&&r.limitConcurrentUploads>a._sending)for(var n=a._slots.shift();n;){if(!n.isRejected()){n.resolve();break}n=a._slots.shift()}})};return this._beforeSend(e,r),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(s=t.Deferred(),this._slots.push(s),o=s.pipe(l)):o=this._sequence=this._sequence.pipe(l,l),o.abort=function(){var t=[void 0,"abort","abort"];return n?n.abort():(s&&s.rejectWith(t),l(!1,t))},this._enhancePromise(o)):l()},_onAdd:function(e,i){var n,s,o=this,a=!0,r=t.extend({},this.options,i),l=r.limitMultiFileUploads;if((r.singleFileUploads||l)&&this._isXHRUpload(r)){if(!r.singleFileUploads&&l)for(n=[],s=0;s<i.files.length;s+=l)n.push(i.files.slice(s,s+l))}else n=[i.files];return i.originalFiles=i.files,t.each(n||i.files,function(s,r){var l=n?r:[r],c=t.extend({},i,{files:l});return c.submit=function(){return c.jqXHR=this.jqXHR=o._trigger("submit",e,this)!==!1&&o._onSend(e,this),this.jqXHR},a=o._trigger("add",e,c)}),a},_normalizeFile:function(t,e){void 0===e.name&&void 0===e.size&&(e.name=e.fileName,e.size=e.fileSize)},_replaceFileInput:function(e){var i=e.clone(!0);t("<form></form>").append(i)[0].reset(),e.after(i).detach(),t.cleanData(e.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(t,n){return n===e[0]?i[0]:n}),e[0]===this.element[0]&&(this.element=i)},_onChange:function(e){var i=e.data.fileupload,n={files:t.each(t.makeArray(e.target.files),i._normalizeFile),fileInput:t(e.target),form:t(e.target.form)};return n.files.length||(n.files=[{name:e.target.value.replace(/^.*\\/,"")}]),i.options.replaceFileInput&&i._replaceFileInput(n.fileInput),i._trigger("change",e,n)===!1||i._onAdd(e,n)===!1?!1:void 0},_onPaste:function(e){var i=e.data.fileupload,n=e.originalEvent.clipboardData,s=n&&n.items||[],o={files:[]};return t.each(s,function(t,e){var i=e.getAsFile&&e.getAsFile();i&&o.files.push(i)}),i._trigger("paste",e,o)===!1||i._onAdd(e,o)===!1?!1:void 0},_onDrop:function(e){var i=e.data.fileupload,n=e.dataTransfer=e.originalEvent.dataTransfer,s={files:t.each(t.makeArray(n&&n.files),i._normalizeFile)};return i._trigger("drop",e,s)===!1||i._onAdd(e,s)===!1?!1:(e.preventDefault(),void 0)},_onDragOver:function(t){var e=t.data.fileupload,i=t.dataTransfer=t.originalEvent.dataTransfer;return e._trigger("dragover",t)===!1?!1:(i&&(i.dropEffect=i.effectAllowed="copy"),t.preventDefault(),void 0)},_initEventHandlers:function(){var t=this.options.namespace;this.options.dropZone.bind("dragover."+t,{fileupload:this},this._onDragOver).bind("drop."+t,{fileupload:this},this._onDrop).bind("paste."+t,{fileupload:this},this._onPaste),this.options.fileInput.bind("change."+t,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var t=this.options.namespace;this.options.dropZone.unbind("dragover."+t,this._onDragOver).unbind("drop."+t,this._onDrop).unbind("paste."+t,this._onPaste),this.options.fileInput.unbind("change."+t,this._onChange)},_setOption:function(e,i){var n=-1!==t.inArray(e,this._refreshOptionsList);n&&this._destroyEventHandlers(),t.Widget.prototype._setOption.call(this,e,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is("input:file")?this.element:this.element.find("input:file"):e.fileInput instanceof t||(e.fileInput=t(e.fileInput)),e.dropZone instanceof t||(e.dropZone=t(e.dropZone))},_create:function(){var e=this.options,i=t.extend({},this.element.data());i[this.widgetName]=void 0,t.extend(e,i),e.namespace=e.namespace||this.widgetName,this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),t.Widget.prototype.destroy.call(this)},enable:function(){t.Widget.prototype.enable.call(this),this._initEventHandlers()},disable:function(){this._destroyEventHandlers(),t.Widget.prototype.disable.call(this)},add:function(e){e&&!this.options.disabled&&(e.files=t.each(t.makeArray(e.files),this._normalizeFile),this._onAdd(null,e))},send:function(e){return e&&!this.options.disabled&&(e.files=t.each(t.makeArray(e.files),this._normalizeFile),e.files.length)?this._onSend(null,e):this._getXHRPromise(!1,e&&e.context)}})});